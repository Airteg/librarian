# 1) Чи треба запускати SQL-скрипти щоразу?

**Ні.**
Ті скрипти (створення таблиць, тригерів, RLS-політик) виконуються **один раз на проєкт/середовище** і лишаються в БД. Перезавантаження комп’ютера на це не впливає — Supabase це керована хмара з постійним сховищем.

Коли їх запускати знову:

- створив **новий Supabase-проєкт** → треба застосувати міграції/скрипти в ньому;
- **змінив схему** (нове поле/таблиця/політика) → робиш **нову** міграцію й запускаєш її один раз;
- хочеш **очистити/перебудувати** БД (рідко в реальному житті) → робиш це усвідомлено й потім знову застосовуєш міграції.

> Той «safe»-скрипт, що я дав, **можна запускати повторно без шкоди**: він лише додає те, чого бракує. Але потреби щодня в цьому немає.

---

# 2) Навіщо ми взагалі писали SQL? Чи це «бекенд»?

Так. У нашій моделі **Supabase = бекенд** (Postgres + Auth + Realtime).
SQL-скрипти — це “прошивка” бекенду: ми визначили **що є** (таблиці) і **як поводиться** (правила доступу і реакції на події).

Конкретно що ми зробили:

- **Схема даних**
  Таблиці:

  - `profiles` — профілі юзерів (дзеркало `auth.users`),
  - `rooms` — кімнати,
  - `room_players` — зв’язок «кімната ↔ учасник»,
  - `events` — події в межах кімнати.

- **RLS (Row Level Security)**
  Політики з префіксом `cabinet_*` обмежують доступ:

  - читати кімнату/події може тільки **учасник** цієї кімнати (або власник),

  - створити кімнату може тільки **власник** (сам для себе),

  - приєднатися/вийти з кімнати можна тільки **за свій user_id**,

  - подію може додати тільки **учасник** кімнати.

  > RLS виконується **на сервері БД** при кожному запиті з клієнта. Тобто навіть якщо фронтенд «помилиться», БД не дасть зробити заборонену дію.

- **Тригери (автоматичні реакції на події)**
  Вони теж живуть у БД і запускаються **автоматично**:

  - після реєстрації користувача в Auth → створюється рядок у `profiles`;
  - після створення кімнати → власник **автоматично** додається в `room_players`;
  - перед вставкою `events` → обчислюється **послідовний `rev`** у межах кімнати.

Отже, коли в застосунку ти «створюєш/видаляєш кабінет» або «стріляєш»:

- фронт викликає Supabase SDK → це йде в PostgREST/БД,
- **RLS** перевіряє, чи тобі можна,
- **тригери** роблять допоміжні кроки (автодовключення власника, нумерація ревів),
- запис потрапляє в таблицю,
- **Realtime** (коли підключимо) розсилає оновлення в інші клієнти.

Все це — логіка бекенду, яку ми зафіксували **SQL-скриптами**. Їх не треба «тримати увімкненими» — вони один раз налаштовують базу, а потім база сама дотримується цих правил.

---
